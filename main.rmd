---
title: "Info 201 Project"
output: html_notebook
---
# Load libraries and packages, print out sample of datasets
influenza vaccine data source: https://data.cdc.gov/Flu-Vaccinations/Influenza-Vaccination-Coverage-for-All-Ages-6-Mont/vh55-3he6
covid vaccine data source: https://data.cdc.gov/Vaccinations/COVID-19-Vaccinations-in-the-United-States-County/8xkx-amqh
Question: Does the % of influenza vaccinations pre covid (2019-2020) correlate to the % of Covid-19 Dose 1 Vaccinations (as of 2023-05-10) *May add more time stamps* in US Counties?

Theory: We may be able to extrapolate based on our question whether or not people how people's willingness to take vaccines in general (the assumption is that influenza vaccines can represent "vaccines in general") impacts their willingness to take the Covid-19 vaccine.
```{r}
library(tidyverse)
influenza_vaccine_data = read_csv("data/Influenza_data.csv")
print(sample_n(influenza_vaccine_data,10))
covid_vaccine_data = read_csv("data/Covid_data.csv") # Note: the covid data is huge relative to the influenza data, so it might take some time to load
print(sample_n(covid_vaccine_data,10))
#print(covid_vaccine_data)
```
# Data Cleaning, Influenza Vaccine
Filter out irrelevant geography types to get only the counties, clean up some other aspects
It is important to point out that this data is estimated based off of state data and population distribution
```{r}
# Note: This dataset has column names which haves spaces in them. When refering to these columns, enclose the column name with backticks (`). FIPS = County identifier (Since many counties have duplicate names).
influenza_vaccine_data_cleaned = influenza_vaccine_data %>%
  filter(Vaccine == "Seasonal Influenza") %>% # Only the general influenza vaccine will be considered as the special variants make up a negligible proportion
  filter(`Geography Type` == "Counties") %>% # Filter out non-county data (state/local areas)
  filter(`Dimension Type` == "Age") %>% # Filter out vaccine demographic data (data only includes people >=18)
  filter(!is.na(as.numeric(FIPS))) %>% # Remove unique region-county identifiers
  filter(`Season/Survey Year` == "2019-20") %>% # Only keep 2019-2020 data for simplicity (may add more dates later)
  rename(Influenza_Percentage = `Estimate (%)`) %>%
  mutate(Influenza_Percentage = as.numeric(Influenza_Percentage)) %>%# Convert the estimate % from character to numeric
  #rename(Date = "Season/Survey Year")
  select(FIPS, Influenza_Percentage) # Filter out irrelevant columns


print(sample_n(influenza_vaccine_data_cleaned,10))
```
# Data Cleaning, Covid Vaccine
add description here
```{r}
covid_vaccine_data_cleaned = covid_vaccine_data %>%
  select(FIPS, Administered_Dose1_Pop_Pct, Date) %>% # Remove unnecessary columns. We'll only look at dose1 in the two dose covid vaccine.
  #mutate(Recip_County = sub(" .*", "", Recip_County)) %>% # Remove the unnecessary "county" specification after every county name
  mutate(Date = as.Date(Date,format = "%m/%d/%Y")) %>% # Convert dates into a R friendly format
  filter(!is.na(as.numeric(FIPS))) %>% # Remove unique region-county identifiers
  rename(Covid_Percentage = Administered_Dose1_Pop_Pct)
print(covid_vaccine_data_cleaned)
```
# Combine Dataframes
```{r}
# This is a quick and dirty way to combine the data
# I only consider the most recent covid vaccination poll
# It might be better to demonstrate it over time

covid_vaccine_data_latest = covid_vaccine_data_cleaned %>%
  group_by(FIPS) %>%
  top_n(1, Date) # Only get the most recent date for each county (may add more dates later)
vaccine_data_latest = merge(influenza_vaccine_data_cleaned, covid_vaccine_data_latest, by = c("FIPS"), all = TRUE)
vaccine_data_latest = select(vaccine_data_latest,FIPS, Influenza_Percentage, Covid_Percentage)
print(vaccine_data_latest)
```

# Basic Plot (Latest)
TODO: Find the correlation coefficent between covid percentage and infl percentage
```{r}
vaccine_data_latest %>%
        ggplot(aes(x = Influenza_Percentage, y = Covid_Percentage)) +
        geom_point()
```
# County Map Example
```{r}
library(usmap)
vaccine_data_latest_corrected = rename(vaccine_data_latest, fips = FIPS) # For some reason the map library requires the fips column to be lowercase
plot_usmap( data = vaccine_data_latest_corrected , values = "Influenza_Percentage", "counties", color="black")
plot_usmap( data = vaccine_data_latest_corrected , values = "Covid_Percentage", "counties", color="black")

```
